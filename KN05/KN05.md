![TBZ Logo](../x_gitres/tbz_logo.png)


[TOC]

# KN05: Netzwerk / Sicherheit

Beachten Sie die [allgemeinen Informationen zu den Abgaben](https://gitlab.com/ch-tbz-it/Stud/m346/m346/-/blob/main/Abgaben.md).

In dieser Kompetenz werden wir das Netzwerk bei AWS ein wenig genauer anschauen. [Lesen Sie zuerst die Theorie durch](https://gitlab.com/ch-tbz-it/Stud/m346/m346/-/blob/main/CloudComputing.md#netzwerk-und-sicherheit). Bisher wurden die Netzwerk-Eigenschaften weitgehend automatisch erstellt. Wir wollen nun die Kontrolle ausüben.

> Sie werden nun **zwei neue** Instanzen erstellen und die Datenbank vom Webserver trennen.



## Lernziele

- Sie setzen sich vertieft mit dem Netzwerk von public Cloud Anbieter auseinander. 
- Sie verstehen was eine VPC ist und Sie verstehen was ein Subnetz ist.
- Sie verstehen die verschiedenen Netzwerk-Komponenten, die eine virtuelle Instanz benötigt, speziell Sicherheitsgruppe, Netzwerkinterface, (statische) öffentliche IP, private IP
- Sie werden zwei virtuelle Instanzen erstellen und das Zusammenspiel der Netzwerk-Komponenten testen.



## A) Grundbegriffe und private IP wählen (30%)

Sie werden nun nicht einfach zwei Instanzen hochfahren, sondern diese gezielt planen. Speziell legen Sie das Subnetz und die privaten IPs fest. Dies ist notwendig, damit die Datenbank nicht dauernd eine neue IP bekommt und die Verbindung auf die Datenbank konstant möglich ist. 

Bisher haben Sie im AWS-Bereich *EC2* gearbeitet, um Instanzen zu erstellen. Öffnen Sie nun **in einem zweiten Tab** den Bereich *VPC* und schauen Sie sich in der linken Navigation die beiden Punkte *VPC*s und *Subnets* an. 

![vpc](./x_res/vpc.png)

Erklären Sie beide Begriffe *VPC* und *Subnet* mit eigenen Worten. Wie viele Subnets haben Sie bereits vordefiniert? Decken die IP Ranges des Subnets den gesamten IP Range des VPC ab?

Erklären Sie den Unterschied zwischen einer öffentlichen und einer private IP. Was ist eine statische IP?

Finden Sie heraus in welchem Subnet Ihre Instanz aus der vorherigen KN04 liegt. Dies finden Sie in den Details der Instanz. Geben Sie nun dem Subnet den Namen ***Sub-KN04***. 

Wählen Sie nun ein **beliebiges anderes** Subnetz und geben Sie den Namen ***Sub-KN05**. **Ab sofort erstellen Sie jede KN in einem neuen Subnetz. Sie können daher auch gleich alle Namen vergeben.**

Da wir nun zwei Instanzen hochfahren werden (Datenbank- und Webserver), benötigen Sie zwei private IPs im korrekten Subnetz.  Definieren Sie die beiden private IPs

**Bedingungen**: 

- Die letzte Zahl der beiden IP Adressen muss durch 10 teilbar sein (z.B. xxx.xxx.xxx.10, xxx.xxx.xxx.150, etc).
- Die IPs liegen im korrekten Subnetz IP Range.



**Abgaben:**

- Erklärung zu den Begriffen *VPC*, *Subnetz*, *public IP*, *private IP* und *static IP* wie oben verlangt.
- Screenshot der Subnetz-Liste mit den angepassten Namen sichtbar
- Zwei definierte IPs für Web- und DB-Server/Instanz. Dazu braucht es keinen Screenshot, einfach nur die beiden IPs als Text.



## B) Objekte und Instanzen erstellen (70%)

Nachdem Sie sich nun auf das Subnetz und IPs festgelegt haben, können Sie die restlichen Objekte anlegen. 

### Sicherheitsgruppe

Erstellen Sie zuerst zwei Sicherheitsgruppen für die beiden Instanzen. Es sind unterschiedliche Ports zu öffnen. Finden Sie heraus welchen Port Ihre MariaDB benötigt. 

Geben Sie den Sicherheitsgruppen sinnvolle Namen (wie z.B. SG-Webserver). Diese Sicherheitsgruppen können Sie auch für zukünftige Instanzen verwenden.

> **Achtung Sicherheit**: Ihre Datenbank darf auf dem Datenbank Port **nicht** öffentlich erreichbar sein, sondern nur im internen Subnetz von AWS!

**Abgaben**

- Screenshot der Liste der Sicherheitsgruppe mit sprechenden Namen/Feldern.
- Screenshot der Inbound-Regeln für beide Sicherheitsgruppen.



### Öffentliche, statische IP

Während es keine grosse Rolle spielt welche öffentlich IP Ihre Datenbank hat, ist eine statische IP für Ihren Webserver wichtig. Erstellen Sie eine öffentliche, statische IP für Ihren Webserver. Dies finden Sie im Bereich *EC2* in der linken Navigation unter *Elastic IPs*. Nur wenn Sie explizit statische IPs erstellen, bleiben die IPs bei Ihrem Instanzen erhalten nach einem Neustart. 

Geben Sie der IP einen sinnvollen Namen, z.B. *IP-Web*

**Abgaben**

- Screenshot der Liste der Elastic IPs mit mit der erstellten IP sichtbar.

### Instanzen erstellen

Erstellen Sie nun die beiden Instanzen und stellen Sie sicher, dass Sie alle Komponenten korrekt ausgewählt oder gesetzt haben (Subnetz, private IP, Sicherheitsgruppe, statische öffentliche IP)

Sie können nun zeigen, dass die gesetzten privaten IPs und die öffentliche, statische IP tatsächlich erhalten bleiben, wenn Sie die Instanzen stoppen.

**Abgaben**

- Screenshot der Liste der Instanzen, wenn beide Instanzen **gestoppt** sind. Die Werte der öffentlichen und private IPs und der Status (gestoppt) müssen sichtbar sein. 
- Screenshot der Details beider Instanzen, so dass die **Subnet ID** sichtbar ist. Dies kann im Screenshot oben bereits enthalten sein. Dann benötigen Sie nur einen Screenshot

**Abgaben**

- Zeigen Sie, dass Sie immer noch **alle drei** Seiten aufrufen können (index.html, info.php und db.php) und keine Fehler kriegen.



## Leitfragen / Checkpoints

- Ich kenne die Bedeutung von VPC und Subnet und kann die Begriffe erklären.
- Ich kenne den Unterschied von privaten, öffentlichen und statischen IPs und kann die Unterschiede erklären.
- Ich kann grob erklären für was ein Port verwendet wird und wieso die Services einen unterschiedlichen Port verwenden.
- Ich kann erklären was eine Sicherheitsgruppe, resp. eine Firewall ist und welche Parameter dort einstellen kann.
- Ich kann den Befehl `sed` erklären und ihn zum Ersetzen von Inhalte verwenden.
