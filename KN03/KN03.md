![TBZ Logo](../x_gitres/tbz_logo.png)


[TOC]

# KN03: IaaS - Virtuelle Server

Beachten Sie die [allgemeinen Informationen zu den Abgaben](https://gitlab.com/ch-tbz-it/Stud/m346/m346/-/blob/main/Abgaben.md).

## Lernziele

- Sie machen die ersten Schritte mit IAAS.
- Eigene manuelle Installation einer virtuellen Instanz. Sie können Services auf einer virtuellen Instanz installieren und Dateien aus einem Git-Repo herunterladen und verwenden
- Sie lernen wie Sie eine Sicherheitsgruppe (Firewall) erstellen, resp. verändern.



## A) Installation von Web- und Datenbankserver (60%)

Sie können hier die Instanzen Aus KN02 verwenden. Wir installieren nun einen Webserver und eine Datenbank auf ihrem Ubuntu. Führen Sie folgende Punkte aus:

- Führen Sie folgende Befehl aus. Sie müssen die Befehle im Detail verstanden haben und werden von der Lehrperson bei der Abgabe zu den Befehlen und installierten Modulen befragt.
  - `sudo apt update` auf. Dieser Befehl aktualisiert die Pakete/Software.
  - `sudo apt install apache2`. Dieser Befehl installiert den Apache Webserver.
  - `sudo apt install php`. Dieser Befehl installiert den PHP Applikationsserver.
  - `sudo apt install libapache2-mod-php`. Dieser Befehl installiert die PHP-Erweiterung für Apache.
  - `sudo apt install mariadb-server`. Dieser Befehl installiert den Datenbankserver.
  - `sudo apt install php-mysql`. Dieser Befehlt installiert das PHP-Modul, um Datenbank-Abfragen zu erstellen.
  - `sudo mysql -sfu root -e "GRANT ALL ON *.* TO 'admin'@'%' IDENTIFIED BY 'Ihr-Passwort' WITH GRANT OPTION;"`. Dieser Befehl erstellt einen neuen Benutzer *admin* mit dem Passwort *Ihr-Passwort*. Wir werden diesen gleich verwenden. **Achtung**: **Passen Sie das Passwort an und verwenden Sie etwas einzigartiges was Ihre Kollegen nicht verwenden.**  Ihr Passwort wird aber für die Lehrperson sichtbar sein, daher bitte kein privates Passwort wiederholen.
  - `sudo systemctl restart mariadb.service`. Dieser Befehl startet den DB Server neu.
  - `sudo systemctl restart apache2`. Dieser Befehl startet den Webserver neu.

- `cd ~`. Dieser Befehl stellt sicher, dass Sie sich in ihrem Home-Verzeichnis befinden

- `git clone https://gitlab.com/ch-tbz-it/Stud/m346/m346scripts.git`. Diesen Befehl sollten Sie bereits beherrschen. 

- Schauen Sie sich die Dateien im Ordner `./m346scripts/KN03/` an. Was müssen Sie ändern, damit keine Seite Fehler wirft? Die Änderung (eine Änderung in einer Datei) hat einen direkten Zusammenhang zu den Befehlen, die Sie oben ausgeführt haben.

- `sudo cp ./m346scripts/KN03/*.php /var/www/html/`. Dieser Befehl kopiert die beiden PHP-Dateien in das Verzeichnis des Webservers.

Zu diesem Zeitpunkt können Sie noch keine Seiten aufrufen, weil die Sicherheitsgruppe dies noch nicht zulässt. 

- Suchen Sie selbstständig die korrekte Sicherheitsgruppe für Ihre Instanz und passen Sie die Regeln so an, dass die **beiden Ports 80 und 22** durchgelassen werden. Ändern Sie nie die ausgehenden Regeln nur die eingehenden.

- Versuchen Sie von ihrem Rechner nun die folgenden Seiten aufzurufen. 

  - *http://[Ihre-IP]/index.html*. Diese URL zeigt ihnen die Informationen von Apache an. Wenn die Seite funktioniert, zeigt dies, dass Apache installiert wurde und funktioniert.

  - *http://[Ihre-IP]/info.php*. Diese URL zeigt ihnen die Informationen von PHP an. Wenn diese Seite funktioniert, zeigt dies, dass das PHP-Modul funktioniert und Sie nun dynamische Seiten hosten können.

  - *http://[Ihre-IP]/db.php*. Diese URL zeigt ihnen die Datenbank-Benutzer. Wenn diese Seite funktioniert, zeigt es Ihnen, dass die Datenbank-Verbindung funktioniert.

- Rufen Sie auf dem Server die `mysql` Konsole auf und loggen Sie sich mit dem eben erstellen Benutzer *admin* ein. Verwenden Sie dazu die Optionen `-u und -p`. Rufen Sie nun die gleiche Abfrage auf, die auch die Seite *db.php* verwendet.

  

  > Falls sudo nicht geht, können Sie `yum` verwenden. Vollständige Erklärung zu `yum` siehe: [https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/7/html/system_administrators_guide/ch-yum](https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/7/html/system_administrators_guide/ch-yum). Allerdings haben Sie in diesem Fall das falsche Image ausgewählt (anstatt Ubuntu amzon-linux). Entweder Sie korrigieren diesen Fehler oder Sie verwenden alternativ die folgende Anleitung: [https://linux.how2shout.com/installing-mariadb-on-amazon-linux-2023/](https://linux.how2shout.com/installing-mariadb-on-amazon-linux-2023/)

  

**Abgabe**:

- Erstellen Sie Screenshots der **funktionierenden** Webseiten (mit sichtbarer URL).
- Screenshot der Details der Instanz mit sichtbarer öffentlichen IP.
- Screenshot der Regeln der Sicherheitsgruppe
- Screenshot des Befehls zum einloggen in die *mysql* Konsole und das entsprechende Resultat der Abfrage. 
- Kurze Erklärung was Ihre SQL-Abfrage (SELECT-Statement) ausliest.



## Leitfragen / Checkpoints

- Ich kenne die Bedeutung und Anwendungsfälle von `sudo`.
- Ich kann mit Hilfe von `apt` Pakete installieren.
- Ich kann erklären was die Pakete *apache2*, *php* und *mariadb-server* installieren.
- Ich kann erklären wieso die Pakete *libapache2-mod-php* und *php-mysqli* benötigt werden und was die Rollen von Ihnen sind.
- Ich kenne den Bereich *Sicherheitsgruppen* und kann Einstellungen an den Regeln ändern.
- Ich weiss was ein Port ist und kann die Sicherheitsgruppe so einstellen, dass ein Port öffentlich zugänglich ist.
- Ich kann die `mysql` Konsole anwenden und Befehle übergeben oder mich in die Konsole einloggen. 
- Ich kann den Befehl `systemctl` für gegebenen Services aufrufen mit den Optionen *start, stop, restart, status*.
- Ich kann mit Hilfe des Befehls `cp` Dateien und Ordner kopieren.
